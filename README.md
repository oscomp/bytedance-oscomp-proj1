# proj127-Realization of Burst Instance Based on Ghost
### 项目名称
基于ghost的突发实例实现

### 项目描述与背景

基于ghsot用户态调度器框架，开发一种用户态调度算法，实现突发实例的管理。

对于微服务、低延迟交互应用程序、中小型数据库、虚拟桌面、代码库和产品原型在内的各种通用工作负载，通常不需要CPU持续高速运行，但是在适当的时候需要占据CPU高速运行。
因此需要根据这类负载的工作特性，设计突发实例调度，既能够限制CPU的总体使用率，又能让应用在真正需要时短时提高CPU占用率，甚至独占CPU，实现快速响应与处理。

突发性能实例是一种通过CPU积分来保证计算性能的实例规格，适用于平时CPU使用率低，但偶尔有突发高CPU使用率的场景。因此，目前有些公有云服务供应商售卖的虚拟机服务中，就有提供一种突发实例的类型供用户使用，如AWS的[可突增性能实例](https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/burstable-performance-instances.html)。

### 功能描述

以QEMU作为模拟器及虚拟机监管器（即一台QEMU虚拟机为一个突发实例，因此下文中的虚拟机与突发实例含义相同），基于ghsot用户态调度器框架，开发一种用户态调度算法，实现对多个突发实例（QEMU虚拟机）的管理。

#### 相关概念解释

- 基准利用率

  由于突发实例的超分比一般大于1，即存在多个vcpu（虚拟CPU）对应一个pcpu（物理CPU）的情况，因此需要限制每个突发实例（虚拟机）的vcpu的基准使用率。每个 vcpu 的基准利用率，表示这种实例在长时间的平均 cpu 利用率。具体的，在没有累计积分的情况下，基准利用率为 10 ％的实例最多以 10 ％的利用率占用物理cpu运行。在有积累积分的情况下，能以超过 10 ％的利用率占用物理 cpu 运行，超过 10 ％的部分由积累积分的大小决定。

- CPU积分的度量

  1个积分可供1 个vcpu以100％负载运行1分钟，或者可供2 个vcpu以50％负载运行1分钟。实例空闲时会积累积分，可以用于需要时突破对虚拟机的基准利用率的限制。积分衡量了可以短时占据cpu运行的能力。


- 累积积分

  当实例vcpu使用率小于基准利用率时，会获得累计积分。换句话说，累积积分 = 获得的积分 - 已使用的积分，但累积积分在达到**最大积分**后，停止累积。

  例如：

  某个突发实例有2个vcpu，其基准利用率为5%，它以 2% 的 CPU 使用率运行60分钟，则累积积分的计算方式如下：

  累积积分 =（60分钟获得的积分 - 每小时使用的积分）= 2 个 vCPU * 5% CPU 基准利用率 * 60 分钟  - 2 个 vCPU * 2% CPU 使用率 * 60 分钟 = 6 - 2.4 =  3.6 个积分

- 最大积分数

  为了限制突发实例积累的最大积分数，在突发实例空闲（vcpu使用率为0）时间达到 24 小时后，即使虚拟机空闲也不再增加其积分数。即最大积分值为虚拟机空闲24小时的累计积分

#### 基础功能：
1、支持以指定的cpu使用率和vcpu个数来创建新的突发实例，并且能够对实例的生命周期进行管理。

2、实现突发实例积分管理功能

	用户创建一个新的突发实例后，若实例在运行就会连续不断的获得积分和消耗积分，每小时获得的积分数 = CPU基准使用率 * vCPU 数 * 60 分钟

	当实例使用的积分 < 基准使用率所需的积分时，未使用的CPU积分将会计入累计积分，（累积积分 = 获得的积分 - 已使用的积分），但累积积分在达到最大积分后，停止累积，其中最大积分值为24小时的累计积分；

	当实例使用的积分 > 基准使用率所需的积分时，消耗累计积分，若累计积分大于0，允许该实例突破CPU基准使用率来运行，若累计积分消耗为0后，对该实例进行限制，只允许其以基准使用率来运行。

	当实例使用的积分 = 基准使用率所需的积分时，累计积分不增加也不减少。

3、支持实例累计积分的实时查询与动态设置，形式不限，如：proc虚拟文件等形式。

#### 扩展功能：
1、在CPU累计积分较少时，动态规划实例的积分消耗，保证实例性能将在20分钟内平滑的下降到基准性能水平，既能保证实例的积分消耗完，又能避免实例性能急剧下降。

2、能够提供累计积分监控曲线显示。


### 所属赛道

2022全国大学生操作系统比赛的“OS功能挑战”赛道



### 参赛要求

- 以小组为单位参赛，最多三人一个小组，参赛对象为全国普通高等学校全日制在校本科生和在校研究生，参赛队员的在校本科生或在校研究生身份均以报名时为准
- 如学生参加了多个项目，参赛学生选择一个自己参加的项目参与评奖
- 请遵循“2022全国大学生操作系统比赛”的章程和技术方案要求



### 项目导师

吴云 wuyun.abel@bytedance.com

贾浩 jiahao.os@bytedance.com




### 难度

中




### 参考资料

ghost相关参考资料

kernel：https://github.com/google/ghost-kernel

User-Space： https://github.com/google/ghost-userspace

qemu：https://github.com/qemu/qemu

AWS突发实例参考：https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/burstable-performance-instances.html

### License

* [GPL-2.0](https://opensource.org/licenses/GPL-2.0)



## 预期目标

完成基础功能和扩展功能的开发，并输出说明文档一篇。

**注意：下面的内容是建议内容，不要求必须全部完成。选择本项目的同学也可与导师联系，提出自己的新想法，如导师认可，可加入预期目标**

参考任务描述部分。
